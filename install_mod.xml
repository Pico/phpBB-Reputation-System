<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--NOTICE: Please open this file in your web browser. If presented with a security warning, you may safely tell it to allow the blocked content.-->
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD.\nAlthough MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD.\nNo support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.5.xsd">
	<header>
		<meta name="generator" content="MODX file generated with PP MODX Creator by tumba25 (online version)"/>
		<meta name="generator" content="MODX file generated by MODX Generator by tumba25"/>
		<license><![CDATA[http://opensource.org/licenses/gpl-license.php GNU General Public License v2]]></license>
		<title lang="en"><![CDATA[Reputation System]]></title>
		<description lang="en"><![CDATA[A full reputation system for phpBB3, with adjustable reputation settings. It allows forum users to rate posts or users, view rating statistics, reputation rankings. Users can write a short comment with giving reputation.]]></description>
		<author-notes lang="en"><![CDATA[Post rating icons are included in phpBB package. If you use another style and it hasn't them, you need to copy them from prosilver imageset or contrib/images.

Special thanks to VSE for finding and correct spelling mistakes.
Special thanks to Versusnja, who present me how AJAX works.]]></author-notes>
		<author-group>
			<author>
				<username><![CDATA[Pico88]]></username>
				<homepage><![CDATA[http://pico88.github.com/phpBB-Reputation-System/]]></homepage>
			</author>
			<author>
				<username><![CDATA[Versusnja]]></username>
				<contributions-group>
					<contributions status="past" from="2012-05-07" to="2012-09-08" position="Developer"/>
				</contributions-group>
			</author>
		</author-group>
		<mod-version>0.6.1</mod-version>
		<installation>
			<level>easy</level>
			<time>600</time>
			<target-version>3.0.11</target-version>
		</installation>
		<history>
			<entry>
				<date>2012-11-14</date>
				<rev-version>0.6.1</rev-version>
				<changelog lang="en">
					<change><![CDATA[Fix negative points for posts]]></change>
					<change><![CDATA[Fix error with missing variables]]></change>
					<change><![CDATA[Fix reputation sorting and pagination in MCP and UCP]]></change>
					<change><![CDATA[Hide truncate post link for regular users]]></change>
					<change><![CDATA[Add AJAX Catch up news]]></change>
					<change><![CDATA[Improve popup div position]]></change>
					<change><![CDATA[Change notification about new points]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2012-11-11</date>
				<rev-version>0.6.0</rev-version>
				<changelog lang="en">
					<change><![CDATA[REWRITE mod to work in AJAX]]></change>
					<change><![CDATA[IMPROVE synchronization]]></change>
					<change><![CDATA[CHANGE templates]]></change>
					<change><![CDATA[ADD truncate post reputation]]></change>
					<change><![CDATA[ADD ajax sorting in popup]]></change>
					<change><![CDATA[UPDATE jQuery to 1.8.2]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2012-09-23</date>
				<rev-version>0.5.1</rev-version>
				<changelog lang="en">
					<change><![CDATA[FIX for sync with APC cache]]></change>
					<change><![CDATA[FIX UPC - an error during disabled ranks]]></change>
					<change><![CDATA[Add missing rank image in UCP front]]></change>
					<change><![CDATA[FIX viewtopic if ranks are enabled]]></change>
					<change><![CDATA[FIX non define avatar image variable]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2012-09-17</date>
				<rev-version>0.5.0</rev-version>
				<changelog lang="en">
					<change><![CDATA[ADD ajax user rating]]></change>
					<change><![CDATA[IMPROVE acp outlook]]></change>
					<change><![CDATA[ADD truncate function]]></change>
					<change><![CDATA[REWRITE code is some places to improve functionality]]></change>
					<change><![CDATA[FIX bug with power explanation]]></change>
					<change><![CDATA[REWRITE html and css]]></change>
					<change><![CDATA[ADD charset limit for comments]]></change>
					<change><![CDATA[ADD support for MOD Version Check]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2012-08-20</date>
				<rev-version>0.4.3</rev-version>
				<changelog lang="en">
					<change><![CDATA[FIX enable post rating in ACP, which hasn't any effect on viewing posts]]></change>
					<change><![CDATA[FIX warings with postive points insteed of negative ones]]></change>
					<change><![CDATA[ADD remaining points bar]]></change>
					<change><![CDATA[UPDATE jQuery to 1.8.0]]></change>
					<change><![CDATA[CHANGE method for storing reputations]]></change>
					<change><![CDATA[ADD new feature to rate posts without influence on user reputation]]></change>
					<change><![CDATA[ADD language detection for sending PM notification]]></change>
					<change><![CDATA[IMPROVE auto bans for reputation]]></change>
					<change><![CDATA[ADD the explanation how the reputation power is calculated]]></change>
					<change><![CDATA[IMPROVE security for post and user rating]]></change>
					<change><![CDATA[ADJUST Reputation System to phpBB 3.0.11]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2012-06-14</date>
				<rev-version>0.4.2</rev-version>
				<changelog lang="en">
					<change><![CDATA[ADD bans for low reputation]]></change>
					<change><![CDATA[IMPROVE post rating]]></change>
					<change><![CDATA[FIX problem when moderator warn a user and add reputation points for warning]]></change>
					<change><![CDATA[ADD new function, which count how much points we spend and how left we have]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2012-05-24</date>
				<rev-version>0.4.1</rev-version>
				<changelog lang="en">
					<change><![CDATA[IMPROVE AJAX - add refreshibg user reputation]]></change>
					<change><![CDATA[FIX template for UCP Reputation Setting]]></change>
					<change><![CDATA[FIX bug with reputation power]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2012-05-18</date>
				<rev-version>0.4.0</rev-version>
				<changelog lang="en">
					<change><![CDATA[ADD AJAX voting]]></change>
					<change><![CDATA[ADD new functions: hide post, antispam]]></change>
					<change><![CDATA[FIX small bugs in UCP and MCP]]></change>
					<change><![CDATA[ADD converters into install file]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2012-04-03</date>
				<rev-version>0.2.7</rev-version>
				<changelog lang="en">
					<change><![CDATA[CHANGE permissions]]></change>
					<change><![CDATA[ADD UCP modules]]></change>
					<change><![CDATA[ADD new features]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2012-03-07</date>
				<rev-version>0.2.2</rev-version>
				<changelog lang="en">
					<change><![CDATA[ADD ACP give point module]]></change>
					<change><![CDATA[CHANGE force comments behavior]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2012-02-28</date>
				<rev-version>0.2.0</rev-version>
				<changelog lang="en">
					<change><![CDATA[ADD version check]]></change>
					<change><![CDATA[ADD MCP reputation module]]></change>
					<change><![CDATA[FIX template]]></change>
					<change><![CDATA[CHANGE Beta to RC]]></change>
					<change><![CDATA[FIX negative point when reputation power is turned off]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2012-02-23</date>
				<rev-version>0.1.2</rev-version>
				<changelog lang="en">
					<change><![CDATA[FIX synchronization]]></change>
					<change><![CDATA[FIX SQL error with reputation power]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2012-02-20</date>
				<rev-version>0.1.1</rev-version>
				<changelog lang="en">
					<change><![CDATA[FIX permissions]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2012-02-20</date>
				<rev-version>0.1.0</rev-version>
				<changelog lang="en">
					<change><![CDATA[FIX all known bugs]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2012-02-17</date>
				<rev-version>0.0.1</rev-version>
				<changelog lang="en">
					<change><![CDATA[First release for testing]]></change>
				</changelog>
			</entry>
		</history>
		<link-group>
			<link type="language" href="./contrib/polish.xml" lang="pl">Polish</link>
			<link type="language" href="./contrib/russian.xml" lang="pl">Russian</link>
			<link type="contrib" href="./contrib/update_from_0.4.3_to_0.5.0.xml" lang="en">Update from 0.4.3 to 0.5.0</link>
			<link type="contrib" href="./contrib/update_from_0.5.0_to_0.5.1.xml" lang="en">Update from 0.5.0 to 0.5.1</link>
			<link type="contrib" href="./contrib/update_from_0.5.1_to_0.6.0.xml" lang="en">Update from 0.5.1 to 0.6.0</link>
			<link type="contrib" href="./contrib/update_from_0.6.0_to_0.6.1.xml" lang="en">Update from 0.6.0 to 0.6.1</link>
		</link-group>
	</header>
	<action-group>
		<copy>
			<file from="root/install_reputation.php" to="install_reputation.php"/>
			<file from="root/reputation.php" to="reputation.php"/>
			<file from="root/adm/mods/reputation_system_version.php" to="adm/mods/reputation_system_version.php"/>
			<file from="root/adm/style/acp_reputation.html" to="adm/style/acp_reputation.html"/>
			<file from="root/adm/style/rs_config.js" to="adm/style/rs_config.js"/>
			<file from="root/images/reputation/neg.png" to="images/reputation/neg.png"/>
			<file from="root/images/reputation/pos.png" to="images/reputation/pos.png"/>
			<file from="root/includes/functions_reputation.php" to="includes/functions_reputation.php"/>
			<file from="root/includes/acp/acp_reputation.php" to="includes/acp/acp_reputation.php"/>
			<file from="root/includes/acp/info/acp_reputation.php" to="includes/acp/info/acp_reputation.php"/>
			<file from="root/includes/hooks/hook_reputation.php" to="includes/hooks/hook_reputation.php"/>
			<file from="root/includes/mcp/mcp_reputation.php" to="includes/mcp/mcp_reputation.php"/>
			<file from="root/includes/mcp/info/mcp_reputation.php" to="includes/mcp/info/mcp_reputation.php"/>
			<file from="root/includes/ucp/ucp_reputation.php" to="includes/ucp/ucp_reputation.php"/>
			<file from="root/includes/ucp/info/ucp_reputation.php" to="includes/ucp/info/ucp_reputation.php"/>
			<file from="root/language/en/mods/*.*" to="language/en/mods/*.*"/>
			<file from="root/styles/prosilver/template/reputation/*.*" to="styles/prosilver/template/reputation/*.*"/>
			<file from="root/styles/prosilver/theme/reputation.css" to="styles/prosilver/theme/reputation.css"/>
			<file from="root/styles/prosilver/theme/images/*.*" to="styles/prosilver/theme/images/*.*"/>
		</copy>
		<open src="memberlist.php">
			<edit>
				<find><![CDATA[$user->setup(array('memberlist', 'groups'));]]></find>
				<action type="after-add"><![CDATA[$user->add_lang('mods/reputation_system');]]></action>
			</edit>
			<edit>
				<find><![CDATA[$default_key = 'c';]]></find>
				<action type="after-add"><![CDATA[//Reputation System
if ($config['rs_sort_memberlist']){
	//Sort by reputation by default if the mod config says so
	$default_key = 'r';
	//Make it descending by default
	$_REQUEST['sd'] = request_var('sd','d');
}
//Reputation System]]></action>
			</edit>
			<edit>
				<find><![CDATA[			'U_REMOVE_FOE'		=> ($foe && $foes_enabled) ? append_sid("{$phpbb_root_path}ucp.$phpEx", 'i=zebra&amp;remove=1&amp;mode=foes&amp;usernames[]=' . $user_id) : '',
		));]]></find>
				<action type="after-add"><![CDATA[		// Reputation System
		$template->assign_vars(array(
			'USER_ID'			=> $member['user_id'],
			'REPUTATION'		=> $member['user_reputation'],
			'U_VIEW_REP_LIST' 	=> ($auth->acl_get('u_rs_view')) ? append_sid("{$phpbb_root_path}reputation.$phpEx", '&amp;mode=details&amp;u=' . $user_id) : '',
			'S_RATE_USER' 		=> ($config['rs_user_rating'] && $auth->acl_get('u_rs_give')) ? true : false,
			)
		);
		// Reputation System]]></action>
			</edit>
			<edit>
				<find><![CDATA[		$sort_key_text = array('a' => $user->lang['SORT_USERNAME'], 'b' => $user->lang['SORT_LOCATION'], 'c' => $user->lang['SORT_JOINED'], 'd' => $user->lang['SORT_POST_COUNT'], 'f' => $user->lang['WEBSITE'], 'g' => $user->lang['ICQ'], 'h' => $user->lang['AIM'], 'i' => $user->lang['MSNM'], 'j' => $user->lang['YIM'], 'k' => $user->lang['JABBER']);]]></find>
				<inline-edit>
					<inline-find><![CDATA['k' => $user->lang['JABBER']]]></inline-find>
					<inline-action type="after-add"><![CDATA[, 'r' => $user->lang['REPUTATION']]]></inline-action>
				</inline-edit>
			</edit>
			<edit>
				<find><![CDATA[		$sort_key_sql = array('a' => 'u.username_clean', 'b' => 'u.user_from', 'c' => 'u.user_regdate', 'd' => 'u.user_posts', 'f' => 'u.user_website', 'g' => 'u.user_icq', 'h' => 'u.user_aim', 'i' => 'u.user_msnm', 'j' => 'u.user_yim', 'k' => 'u.user_jabber');]]></find>
				<inline-edit>
					<inline-find><![CDATA['k' => 'u.user_jabber']]></inline-find>
					<inline-action type="after-add"><![CDATA[, 'r' => 'u.user_reputation']]></inline-action>
				</inline-edit>
			</edit>
			<edit>
				<find><![CDATA[			'U_LIST_CHAR'			=> $sort_url . '&amp;sk=a&amp;sd=' . (($sort_key == 'l' && $sort_dir == 'a') ? 'd' : 'a'),]]></find>
				<action type="after-add"><![CDATA[			'U_SORT_REPUTATION'		=> $sort_url . '&amp;sk=r&amp;sd=' . (($sort_key == 'r' && $sort_dir == 'd') ? 'a' : 'd'),]]></action>
			</edit>
			<edit>
				<find><![CDATA[		'WARNINGS'		=> isset($data['user_warnings']) ? $data['user_warnings'] : 0,]]></find>
				<action type="after-add"><![CDATA[		'REPUTATION'	=> isset($data['user_reputation']) ? $data['user_reputation'] : 0,]]></action>
			</edit>
		</open>
		<open src="viewtopic.php">
			<edit>
				<find><![CDATA[include($phpbb_root_path . 'includes/bbcode.' . $phpEx);]]></find>
				<action type="after-add"><![CDATA[include($phpbb_root_path . 'includes/functions_reputation.' . $phpEx);]]></action>
			</edit>
			<edit>
				<find><![CDATA[$user->setup('viewtopic', $topic_data['forum_style']);]]></find>
				<action type="after-add"><![CDATA[//Reputation System
$user->add_lang('mods/reputation_system');
//Reputation System]]></action>
			</edit>
			<edit>
				<find><![CDATA[// Grab ranks
$ranks = $cache->obtain_ranks();]]></find>
				<action type="after-add"><![CDATA[// Grab reputation ranks
$rs_ranks = reputation::obtain_rs_ranks();]]></action>
			</edit>
			<edit>
				<find><![CDATA[	'S_ENABLE_FEEDS_TOPIC'	=> ($config['feed_topic'] && !phpbb_optionget(FORUM_OPTION_FEED_EXCLUDE, $topic_data['forum_options'])) ? true : false,]]></find>
				<action type="after-add"><![CDATA[	
	//Reputation System
	'S_ENABLE_REPUTATION'	=> ($topic_data['enable_reputation'] && $topic_data['topic_type'] != POST_GLOBAL && $config['rs_post_rating']) ? true : false,
	//Reputation System]]></action>
			</edit>
			<edit>
				<find><![CDATA[$sql = $db->sql_build_query('SELECT', array(
	'SELECT'	=> 'u.*, z.friend, z.foe, p.*',

	'FROM'		=> array(
		USERS_TABLE		=> 'u',
		POSTS_TABLE		=> 'p',
	),

	'LEFT_JOIN'	=> array(
		array(
			'FROM'	=> array(ZEBRA_TABLE => 'z'),
			'ON'	=> 'z.user_id = ' . $user->data['user_id'] . ' AND z.zebra_id = p.poster_id'
		)
	),

	'WHERE'		=> $db->sql_in_set('p.post_id', $post_list) . '
		AND u.user_id = p.poster_id'
));]]></find>
				<action type="replace-with"><![CDATA[//Reputation System
$sql_array = array(
	'SELECT'	=> 'u.*, z.friend, z.foe, p.*',
	'FROM'		=> array(
		USERS_TABLE => 'u',
		POSTS_TABLE		=> 'p'
	),
	'LEFT_JOIN' => array(
		array(
			'FROM'	=> array(ZEBRA_TABLE => 'z'),
			'ON'	=> 'z.user_id = ' . $user->data['user_id'] . ' AND z.zebra_id = p.poster_id'
		),
	),
	'WHERE'		=> $db->sql_in_set('p.post_id', $post_list) . '
		AND u.user_id = p.poster_id'
);

if ($config['rs_enable'] && $config['rs_post_rating'] && $topic_data['enable_reputation'] && $topic_data['topic_type'] != POST_GLOBAL)
{
	$sql_array['LEFT_JOIN'][] = array('FROM' => array(REPUTATIONS_TABLE => 'r'), 'ON' => 'r.rep_from = ' . $user->data['user_id'] . ' AND r.post_id = p.post_id');
	$sql_array['SELECT'] .= ', r.rep_id AS rated, r.point AS voting_points';
}

$sql = $db->sql_build_query('SELECT', $sql_array);
//Reputation System]]></action>
			</edit>
			<edit>
				<find><![CDATA[		'post_edit_locked'	=> $row['post_edit_locked'],]]></find>
				<action type="after-add"><![CDATA[		//Reputation System
		'post_reputation'	=> $row['post_reputation'],
		'rated' 			=> (isset($row['rated'])) ? true : false,
		'post_vote_class'	=> (isset($row['rated'])) ? ($row['voting_points'] > 0 ? 'rated_good' : 'rated_bad') : '',
		'voting_points'		=> (isset($row['voting_points'])) ? $row['voting_points'] : 0,
		'rs_hide_post'		=> ($row['post_reputation'] <= $config['rs_hide_post']) ? true : false,
		//Reputation System]]></action>
			</edit>
			<edit>
				<find><![CDATA[				'allow_pm'			=> 0,]]></find>
				<action type="after-add"><![CDATA[				'reputation'		=> '',
				'rs_rank_title'		=> '',
				'rs_rank_img'		=> '',
				'rs_rank_img_src'	=> '',
				'rs_rank_color'		=> '',]]></action>
			</edit>
			<edit>
				<find><![CDATA[				'from'			=> (!empty($row['user_from'])) ? $row['user_from'] : '',]]></find>
				<action type="after-add"><![CDATA[				'reputation'		=> $row['user_reputation'],
				'rs_rank_title'		=> '',
				'rs_rank_img'		=> '',
				'rs_rank_img_src'	=> '',
				'rs_rank_color'		=> '',]]></action>
			</edit>
			<edit>
				<find><![CDATA[			get_user_rank($row['user_rank'], $row['user_posts'], $user_cache[$poster_id]['rank_title'], $user_cache[$poster_id]['rank_image'], $user_cache[$poster_id]['rank_image_src']);]]></find>
				<action type="after-add"><![CDATA[			//Reputation System
			if ($config['rs_enable'] && $config['rs_ranks'])
			{
				reputation::get_rs_rank($user_cache[$poster_id]['reputation'], $user_cache[$poster_id]['rs_rank_title'], $user_cache[$poster_id]['rs_rank_img'], $user_cache[$poster_id]['rs_rank_img_src'], $user_cache[$poster_id]['rs_rank_color']);
			}]]></action>
			</edit>
			<edit>
				<find><![CDATA[		!$row['post_edit_locked']
	)));]]></find>
				<action type="after-add"><![CDATA[	//Reputation System
	$rs_box_color = reputation::get_vote_class($row['post_reputation']);
	//Hide post if it has too low rating?
	$rs_hide_post = (!empty($config['rs_hide_post']) && ($row['post_reputation'] <= $config['rs_hide_post']) && $config['rs_enable']) ? true : false;
	$hidden_post_message = $rs_hide_post ? '<div id="hideshow">' . sprintf($user->lang['RS_HIDE_POST'], get_username_string('full', $poster_id, $row['username'], $row['user_colour'], $row['post_username']), '<a href="#" onclick="jRS.showhide(this); return false;">' . $user->lang['RS_SHOW_HIDE_HIDDEN_POST'] . '</a>') . '</div>' : '';
	//Reputation System]]></action>
			</edit>
			<edit>
				<find><![CDATA[		'S_TOPIC_POSTER'	=> ($topic_data['topic_poster'] == $poster_id) ? true : false,]]></find>
				<action type="after-add"><![CDATA[		// Reputation System
		'S_VIEW_REP' 			=> ($auth->acl_get('u_rs_view') || $poster_id == $user->data['user_id']) ? true : false,
		'S_VIEW_REP_LIST'		=> ($auth->acl_get('u_rs_view')) ? true : false,
		'S_GIVE_REPUTATION'		=> ($auth->acl_get('f_rs_give', $forum_id) && $auth->acl_get('u_rs_ratepost') && $poster_id != ANONYMOUS) ? true : false,
		'S_GIVE_NEGATIVE'		=> ($auth->acl_get('f_rs_give_negative', $forum_id) && $config['rs_negative_point']) ? true : false,
		'S_RS_POST_HIGHLIGHT'	=> (!empty($config['rs_post_highlight']) && ($row['post_reputation'] >= $config['rs_post_highlight'])) ? true : false,
		'S_RS_HIDE_POST'		=> $rs_hide_post,
		'L_RS_HIDE_POST'		=> $hidden_post_message,
		'POST_REPUTATION'		=> $row['post_reputation'],
		'RS_BOX_COLOR'			=> $rs_box_color,
		'U_REPUTATION'			=> $user_cache[$poster_id]['reputation'],
		//Own post? Too low rating? Rated_good? Rated_bad?
		'RS_POST_CLASS'		=> ($user->data['user_id'] == $poster_id ? 'own' : '') . $row['post_vote_class'],
		'RS_GIVEN_POINT'	=> $row['voting_points'],
		//Reputation ranks
		'RS_RANK_TITLE'		=> $user_cache[$poster_id]['rs_rank_title'],
		'RS_RANK_IMG'		=> $user_cache[$poster_id]['rs_rank_img'],
		'RS_RANK_IMG_SRC'	=> $user_cache[$poster_id]['rs_rank_img_src'],
		// Reputation System]]></action>
			</edit>
		</open>
		<open src="adm/style/acp_forums.html">
			<edit>
				<find><![CDATA[				<label><input type="radio" class="radio" name="display_recent" value="0"<!-- IF not S_DISPLAY_ACTIVE_TOPICS --> id="display_recent" checked="checked"<!-- ENDIF --> /> {L_NO}</label></dd>
		</dl>]]></find>
				<action type="after-add"><![CDATA[		<dl>
			<dt><label for="enable_reputation">{L_RS_FORUM_REPUTATION}:</label><br /><span>{L_RS_FORUM_REPUTATION_EXPLAIN}</span></dt>
			<dd><label><input type="radio" class="radio" name="enable_reputation" value="1"<!-- IF S_ENABLE_REPUTATION eq 1 --> id="enable_reputation" checked="checked"<!-- ENDIF --> /> {L_RS_POST_WITH_USER}</label><br />
				<label><input type="radio" class="radio" name="enable_reputation" value="2"<!-- IF S_ENABLE_REPUTATION eq 2 --> id="enable_reputation" checked="checked"<!-- ENDIF --> /> {L_RS_POST_WITHOUT_USER}</label><br />
				<label><input type="radio" class="radio" name="enable_reputation" value="0"<!-- IF not S_ENABLE_REPUTATION --> id="enable_reputation" checked="checked"<!-- ENDIF --> /> {L_NO}</label></dd>
		</dl>]]></action>
			</edit>
		</open>
		<open src="adm/style/acp_groups.html">
			<edit>
				<find><![CDATA[		<dd><input name="group_legend" type="checkbox" value="1" class="radio" id="group_legend"{GROUP_LEGEND} /></dd>
	</dl>]]></find>
				<action type="after-add"><![CDATA[  <dl>
      <dt><label for="group_reputation_power">{L_RS_GROUP_POWER}:</label></dt>
      <dd><input name="group_reputation_power" type="text" id="group_reputation_power" maxlength="4" size="4" value="{GROUP_REPUTATION_POWER}" /></dd></dd>
   </dl>]]></action>
			</edit>
		</open>
		<open src="includes/constants.php">
			<edit>
				<find><![CDATA[// Additional tables]]></find>
				<action type="after-add"><![CDATA[//Reputation System
define('RS_COMMENT_OFF', 0);
define('RS_COMMENT_BOTH', 1);
define('RS_COMMENT_POST', 2);
define('RS_COMMENT_USER', 3);
define('REPUTATIONS_TABLE',			$table_prefix . 'reputations');
define('REPUTATIONS_RANKS_TABLE',	$table_prefix . 'reputations_ranks');
define('REPUTATIONS_BANS_TABLE',	$table_prefix . 'reputations_bans');]]></action>
			</edit>
		</open>
		<open src="includes/functions_user.php">
			<edit>
				<find><![CDATA[function user_ban($mode, $ban, $ban_len, $ban_len_other, $ban_exclude, $ban_reason, $ban_give_reason = '')
{
	global $db, $user, $auth, $cache;]]></find>
				<action type="after-add"><![CDATA[	global $config, $phpbb_root_path, $phpEx; //Needed by Reputation System]]></action>
			</edit>
			<edit>
				<find><![CDATA[		$db->sql_multi_insert(BANLIST_TABLE, $sql_ary);]]></find>
				<action type="after-add"><![CDATA[		//Reputation System
		if ($mode == 'user' && !$ban_exclude && $config['rs_max_power_ban'])
		{
			$ban_id = $db->sql_nextid();
			$ban_time = round(($ban_end - $current_time) / 3600);
			$ban_point = round($config['rs_max_power_ban'] * $ban_time / 672);
			$ban_points = ($ban_end == 0) ? -$config['rs_max_power_ban'] : -min($config['rs_max_power_ban'],($ban_point == 0 ? 1 : $ban_point));

			if (!class_exists('reputation'))
			{
				include($phpbb_root_path . '/includes/functions_reputation.' . $phpEx);
			}
			reputation::give_point($ban_entry, 0, $ban_give_reason, false, $ban_points, 'ban');
		}
		//Reputation System]]></action>
			</edit>
		</open>
		<open src="includes/acp/acp_forums.php">
			<edit>
				<find><![CDATA[						'forum_password_unset'	=> request_var('forum_password_unset', false),]]></find>
				<action type="after-add"><![CDATA[						'enable_reputation'		=> request_var('enable_reputation', 0),]]></action>
			</edit>
			<edit>
				<find><![CDATA[							'forum_password_confirm'=> '',]]></find>
				<action type="after-add"><![CDATA[							'enable_reputation'		=> false,]]></action>
			</edit>
			<edit>
				<find><![CDATA[					'S_CAN_COPY_PERMISSIONS'	=> ($action != 'edit' || empty($forum_id) || ($auth->acl_get('a_fauth') && $auth->acl_get('a_authusers') && $auth->acl_get('a_authgroups') && $auth->acl_get('a_mauth'))) ? true : false,]]></find>
				<action type="after-add"><![CDATA[					'S_ENABLE_REPUTATION'		=> $forum_data['enable_reputation'],]]></action>
			</edit>
		</open>
		<open src="includes/acp/acp_groups.php">
			<edit>
				<find><![CDATA[						$submit_ary['founder_manage'] = isset($_REQUEST['group_founder_manage']) ? 1 : 0;
					}]]></find>
				<action type="after-add"><![CDATA[					// Reputation System
					$submit_ary['reputation_power'] = request_var('group_reputation_power', 0);
					// Reputation System]]></action>
			</edit>
			<edit>
				<find><![CDATA[							'skip_auth'		=> 'int',
						);]]></find>
				<action type="after-add"><![CDATA[						// Reputation System
						$test_variables[] = 'reputation_power';
						$test_variables['reputation_power'] = 'int';
						// Reputation System]]></action>
			</edit>
			<edit>
				<find><![CDATA[					'L_AVATAR_EXPLAIN'	=> sprintf($user->lang['AVATAR_EXPLAIN'], $config['avatar_max_width'], $config['avatar_max_height'], round($config['avatar_filesize'] / 1024)),
				));]]></find>
				<action type="after-add"><![CDATA[				// Reputation System
				$template->assign_vars(array(
					'GROUP_REPUTATION_POWER'	=> (isset($group_row['group_reputation_power'])) ? $group_row['group_reputation_power'] : 0,
					));
				// Reputation System]]></action>
			</edit>
		</open>
		<open src="includes/acp/acp_styles.php">
			<edit>
				<find><![CDATA[				'icon_back_top', 'icon_contact_aim', 'icon_contact_email', 'icon_contact_icq', 'icon_contact_jabber', 'icon_contact_msnm', 'icon_contact_pm', 'icon_contact_yahoo', 'icon_contact_www', 'icon_post_delete', 'icon_post_edit', 'icon_post_info', 'icon_post_quote', 'icon_post_report', 'icon_user_online', 'icon_user_offline', 'icon_user_profile', 'icon_user_search', 'icon_user_warn', 'button_pm_forward', 'button_pm_new', 'button_pm_reply', 'button_topic_locked', 'button_topic_new', 'button_topic_reply',]]></find>
				<inline-edit>
					<inline-find><![CDATA['button_topic_new', 'button_topic_reply',]]></inline-find>
					<inline-action type="after-add"><![CDATA[ 'icon_rate_good', 'icon_rate_bad',]]></inline-action>
				</inline-edit>
			</edit>
		</open>
		<open src="includes/mcp/mcp_warn.php">
			<edit>
				<find><![CDATA[		$warning = utf8_normalize_nfc(request_var('warning', '', true));]]></find>
				<action type="after-add"><![CDATA[		$rep_point = (isset($_REQUEST['rep_point'])) ? true : false;
		$rep_power = request_var('rep_power', '');]]></action>
			</edit>
			<edit>
				<find><![CDATA[			$notify = false;]]></find>
				<action type="after-add"><![CDATA[		}
		$rp_power = '';
		for($i = 1; $i <= $config['rs_max_power_warning']; ++$i)
		{
			$rp_power = '<option value="-' . $i . '"> (-' . $i . ') </option>';
			$template->assign_block_vars('reputation', array(
				'REPUTATION_POWER'	=> $rp_power)
			);]]></action>
			</edit>
			<edit>
				<find><![CDATA[				add_warning($user_row, $warning, $notify, $post_id);]]></find>
				<inline-edit>
					<inline-find><![CDATA[				add_warning($user_row, $warning, $notify, $post_id]]></inline-find>
					<inline-action type="after-add"><![CDATA[, $rep_point, $rep_power]]></inline-action>
				</inline-edit>
			</edit>
			<edit>
				<find><![CDATA[			'L_WARNING_POST_DEFAULT'	=> sprintf($user->lang['WARNING_POST_DEFAULT'], generate_board_url() . "/viewtopic.$phpEx?f=$forum_id&amp;p=$post_id#p$post_id"),]]></find>
				<action type="after-add"><![CDATA[			'S_RS_WARNING'		=> ($config['rs_warning'] && $config['rs_max_power_warning']) ? true : false,]]></action>
			</edit>
			<edit>
				<find><![CDATA[		$warning = utf8_normalize_nfc(request_var('warning', '', true));]]></find>
				<action type="after-add"><![CDATA[		$rep_point = (isset($_REQUEST['rep_point'])) ? true : false;
		$rep_power = request_var('rep_power', '');]]></action>
			</edit>
			<edit>
				<find><![CDATA[			$notify = false;]]></find>
				<action type="after-add"><![CDATA[		}
		$rp_power = '';
		for($i = 1; $i <= $config['rs_max_power_warning']; ++$i)
		{
			$rp_power = '<option value="-' . $i . '"> (-' . $i . ') </option>';
			$template->assign_block_vars('reputation', array(
				'REPUTATION_POWER'	=> $rp_power)
			);]]></action>
			</edit>
			<edit>
				<find><![CDATA[				add_warning($user_row, $warning, $notify);]]></find>
				<inline-edit>
					<inline-find><![CDATA[				add_warning($user_row, $warning, $notify]]></inline-find>
					<inline-action type="after-add"><![CDATA[, 0, $rep_point, $rep_power]]></inline-action>
				</inline-edit>
			</edit>
			<edit>
				<find><![CDATA[			'RANK_IMG'			=> $rank_img,]]></find>
				<action type="after-add"><![CDATA[			'S_RS_WARNING'		=> ($config['rs_warning'] && $config['rs_max_power_warning']) ? true : false,]]></action>
			</edit>
			<edit>
				<find><![CDATA[function add_warning($user_row, $warning, $send_pm = true, $post_id = 0)]]></find>
				<inline-edit>
					<inline-find><![CDATA[function add_warning($user_row, $warning, $send_pm = true, $post_id = 0]]></inline-find>
					<inline-action type="after-add"><![CDATA[, $rep_point = false, $rep_power]]></inline-action>
				</inline-edit>
			</edit>
			<edit>
				<find><![CDATA[	$db->sql_query('INSERT INTO ' . WARNINGS_TABLE . ' ' . $db->sql_build_array('INSERT', $sql_ary));]]></find>
				<action type="after-add"><![CDATA[	if ($rep_point)
	{
		include_once($phpbb_root_path . 'includes/functions_reputation.' . $phpEx);
		$reputation = new reputation();
		$reputation->give_point($user_row['user_id'], $post_id, $warning, false, $rep_power, 'warning');
	}]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/imageset/imageset.cfg">
			<edit>
				<find><![CDATA[img_icon_user_warn = icon_user_warn.gif*20*20]]></find>
				<action type="after-add"><![CDATA[img_icon_rate_good = icon_rate_good.gif*20*20
img_icon_rate_bad = icon_rate_bad.gif*20*20]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/index_body.html">
			<edit>
				<find><![CDATA[	<p>{TOTAL_POSTS} &bull; {TOTAL_TOPICS} &bull; {TOTAL_USERS} &bull; {NEWEST_USER}</p>]]></find>
				<action type="after-add"><![CDATA[<!-- ENDIF -->

<!-- IF RS_TOPLIST -->
	<h3>{L_RS_TOPLIST}</h3>
	<p>{L_RS_TOPLIST_EXPLAIN}: <strong>{RS_TOPLIST}</strong></p>]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/mcp_warn_post.html">
			<edit>
				<find><![CDATA[			<dd><label><input type="checkbox" name="notify_user" checked="checked" /> {L_NOTIFY_USER_WARN}</label></dd>]]></find>
				<action type="after-add"><![CDATA[		</dl>
		<!-- ENDIF -->
		<!-- IF S_REPUTATION and S_RS_WARNING -->
		<br /><br />
		<dl class="panel">
			<dt><label>{L_MCP_RS_REP_POINT}</label></dt>
			<dd><select name="rep_power" id="rep_power">
				<!-- BEGIN reputation -->
					{reputation.REPUTATION_POWER}
				<!-- END reputation -->
				</select></dd>
		</dl>
		<dl class="panel">
			<dt>&nbsp;</dt>
			<dd><label><input type="checkbox" name="rep_point" /> {L_MCP_RS_GIVE_REP_POINT}</label></dd>]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/mcp_warn_user.html">
			<edit>
				<find><![CDATA[			<dd><label><input type="checkbox" name="notify_user" checked="checked" /> {L_NOTIFY_USER_WARN}</label></dd>]]></find>
				<action type="after-add"><![CDATA[		</dl>
		<!-- ENDIF -->
		<!-- IF S_REPUTATION and S_RS_WARNING -->
		<br /><br />
		<dl class="panel">
			<dt><label>{L_MCP_RS_REP_POINT}</label></dt>
			<dd><select name="rep_power" id="rep_power">
				<!-- BEGIN reputation -->
					{reputation.REPUTATION_POWER}
				<!-- END reputation -->
				</select></dd>
		</dl>
		<dl class="panel">
			<dt>&nbsp;</dt>
			<dd><label><input type="checkbox" name="rep_point" /> {L_MCP_RS_GIVE_REP_POINT}</label></dd>]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/memberlist_body.html">
			<edit>
				<find><![CDATA[			<th class="info"><a href="{U_SORT_WEBSITE}#memberlist">{L_WEBSITE}</a>{L_COMMA_SEPARATOR}<a href="{U_SORT_LOCATION}">{L_LOCATION}</a></th>]]></find>
				<action type="after-add"><![CDATA[			<!-- IF S_REPUTATION --><th class="posts"><a href="{U_SORT_REPUTATION}#memberlist">{L_REPUTATION}</a></th><!-- ENDIF -->]]></action>
			</edit>
			<edit>
				<find><![CDATA[			<th class="info"><a href="{U_SORT_WEBSITE}#memberlist">{L_WEBSITE}</a>{L_COMMA_SEPARATOR}<a href="{U_SORT_LOCATION}">{L_LOCATION}</a></th>]]></find>
				<action type="after-add"><![CDATA[			<!-- IF S_REPUTATION --><th class="posts"><a href="{U_SORT_REPUTATION}#memberlist">{L_REPUTATION}</a></th><!-- ENDIF -->]]></action>
			</edit>
			<edit>
				<find><![CDATA[		<td class="info"><!-- IF memberrow.U_WWW or memberrow.LOCATION --><!-- IF memberrow.U_WWW --><div><a href="{memberrow.U_WWW}" title="{L_VISIT_WEBSITE}: {memberrow.U_WWW}">{memberrow.U_SHORT_WWW}</a></div><!-- ENDIF --><!-- IF memberrow.LOCATION --><div>{memberrow.LOCATION}</div><!-- ENDIF --><!-- ELSE -->&nbsp;<!-- ENDIF --></td>]]></find>
				<action type="after-add"><![CDATA[		<!-- IF S_REPUTATION --><td class="posts">{memberrow.REPUTATION}</td><!-- ENDIF -->]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/memberlist_view.html">
			<edit>
				<find><![CDATA[					<!-- IF POSTS_IN_QUEUE and U_MCP_QUEUE --><br />(<a href="{U_MCP_QUEUE}">{L_POSTS_IN_QUEUE}</a>)<!-- ELSEIF POSTS_IN_QUEUE --><br />({L_POSTS_IN_QUEUE})<!-- ENDIF -->
				</dd>]]></find>
				<action type="after-add"><![CDATA[			<!-- IF S_REPUTATION -->
				<dt>{L_REPUTATION}:</dt> <dd><span class="user-reputation"><strong>{REPUTATION}</strong></span></a> <!-- IF U_VIEW_REP_LIST or S_RATE_USER --> [ <!-- IF U_VIEW_REP_LIST --><a href="{U_VIEW_REP_LIST}">{L_RS_VIEW_DETAILS}</a><!-- ENDIF --> <!-- IF S_RATE_USER --><!-- IF U_VIEW_REP_LIST --> | <!-- ENDIF --><a href="#" onclick="jRS.userrating('{USER_ID}', event); return false;">{L_RS_RATE_USER}</a><!-- ENDIF --> ]<!-- ENDIF --></dd>
			<!-- ENDIF -->]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/overall_footer.html">
			<edit>
				<find><![CDATA[</body>]]></find>
				<action type="before-add"><![CDATA[<!-- IF S_REPUTATION -->
<!-- INCLUDE reputation/reputation_footer.html -->
<!-- ENDIF -->
]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/viewtopic_body.html">
			<edit>
				<find><![CDATA[	<div id="p{postrow.POST_ID}" class="post <!-- IF postrow.S_ROW_COUNT is odd -->bg1<!-- ELSE -->bg2<!-- ENDIF --><!-- IF postrow.S_UNREAD_POST --> unreadpost<!-- ENDIF --><!-- IF postrow.S_POST_REPORTED --> reported<!-- ENDIF --><!-- IF postrow.S_ONLINE and not postrow.S_IGNORE_POST --> online<!-- ENDIF -->">]]></find>
				<inline-edit>
					<inline-find><![CDATA[<!-- IF postrow.S_ONLINE and not postrow.S_IGNORE_POST --> online<!-- ENDIF -->]]></inline-find>
					<inline-action type="after-add"><![CDATA[<!-- IF S_REPUTATION --><!-- IF postrow.S_RS_POST_HIGHLIGHT --> highlight<!-- ENDIF --><!-- IF postrow.S_RS_HIDE_POST --> hidden<!-- ENDIF --><!-- ENDIF -->]]></inline-action>
				</inline-edit>
			</edit>
			<edit>
				<find><![CDATA[		<div class="inner"><span class="corners-top"><span></span></span>]]></find>
				<action type="after-add"><![CDATA[		{postrow.L_RS_HIDE_POST}]]></action>
			</edit>
			<edit>
				<find><![CDATA[			<div class="content">{postrow.MESSAGE}</div>]]></find>
				<action type="after-add"><![CDATA[			<!-- IF S_REPUTATION and S_ENABLE_REPUTATION -->
				<ul class="post-reputation<!-- IF postrow.RS_POST_CLASS --> {postrow.RS_POST_CLASS}<!-- ENDIF -->">
					<li class="rate-good-icon"><!-- IF postrow.S_GIVE_REPUTATION --><a href="#" onclick="jRS.positive('{postrow.POST_ID}', event, this); return false;" <!-- IF postrow.RS_GIVEN_POINT gt 0 -->class="{postrow.RS_POST_CLASS}" title="{L_RS_YOU_RATED} {postrow.RS_GIVEN_POINT}"<!-- ELSE --> title="{L_RS_RATE_POST}"<!-- ENDIF -->><span>{L_RS_ADD_POINTS}</span></a><!-- ENDIF --></li>
					<li class="reputation {postrow.RS_BOX_COLOR}"><div title="{L_RS_POST_REPUTATION}"><!-- IF postrow.S_VIEW_REP --><a href="#" onclick="jRS.postdetails('{postrow.POST_ID}'); return false;"><!-- ENDIF -->{postrow.POST_REPUTATION}<!-- IF postrow.S_VIEW_REP --></a><!-- ENDIF --></div></li>
					<!-- IF postrow.S_GIVE_REPUTATION && postrow.S_GIVE_NEGATIVE--><li class="rate-bad-icon"><a href="#" onclick="jRS.negative('{postrow.POST_ID}', event, this); return false;" <!-- IF postrow.RS_GIVEN_POINT lt 0 --> class="{postrow.RS_POST_CLASS}" title="{L_RS_YOU_RATED} {postrow.RS_GIVEN_POINT}"<!-- ELSE --> title="{L_RS_RATE_POST}"<!-- ENDIF --> onclick="return false;"><span>{L_RS_SUBTRACT_POINTS}</span></a></li><!-- ENDIF -->
				</ul>
				<br />
			<!-- ENDIF -->]]></action>
			</edit>
			<edit>
				<find><![CDATA[			<dl class="postprofile" id="profile{postrow.POST_ID}">]]></find>
				<action type="replace-with"><![CDATA[			<dl class="postprofile" id="profile{postrow.POSTER_ID}">]]></action>
			</edit>
			<edit>
				<find><![CDATA[		<!-- IF postrow.POSTER_FROM --><dd><strong>{L_LOCATION}:</strong> {postrow.POSTER_FROM}</dd><!-- ENDIF -->]]></find>
				<action type="after-add"><![CDATA[		<!-- IF S_REPUTATION and postrow.U_POST_AUTHOR -->
			<dd class="user-reputation"><strong>{L_REPUTATION}:</strong> <!-- IF postrow.S_VIEW_REP_LIST --><a href="#" onclick="jRS.userdetails('{postrow.POSTER_ID}', '{postrow.POST_ID}'); return false;"><!-- ENDIF --><strong>{postrow.U_REPUTATION}</strong><!-- IF postrow.S_VIEW_REP_LIST --></a><!-- ENDIF --></dd>
			<!-- IF postrow.RS_RANK_IMG --><dd class="reputation-rank">{postrow.RS_RANK_IMG}</dd><!-- ENDIF -->
		<!-- ENDIF -->]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/theme/stylesheet.css">
			<edit>
				<find><![CDATA[@import url("colours.css");]]></find>
				<action type="after-add"><![CDATA[@import url("reputation.css");]]></action>
			</edit>
		</open>
		<php-installer><![CDATA[install_reputation.php]]></php-installer>
		<diy-instructions lang="en"><![CDATA[After installation, go to ACP and enable Reputation System.]]></diy-instructions>
	</action-group>
</mod>
